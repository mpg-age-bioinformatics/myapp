from flaskapp import app, db
import dash
from dash.dependencies import Input, Output, State
import dash_core_components as dcc
import dash_html_components as html
import dash_bootstrap_components as dbc
from flaskapp.models import User
from flaskapp.email import send_validate_email
from datetime import datetime
from ._utils import META_TAGS, check_email, password_check, navbar_A
from flask_login import current_user

dashapp = dash.Dash("gdpr",url_base_pathname='/gdpr/', meta_tags=META_TAGS, server=app, external_stylesheets=[dbc.themes.BOOTSTRAP], title=app.config["APP_TITLE"], assets_folder=app.config["APP_ASSETS"])# , assets_folder="/flaski/flaski/static/dash/")

APP_TITLE=app.config["APP_TITLE"]

gdpr_text=dcc.Markdown(f'''
Thanks for entrusting Flaski with your data. Holding on to your private information is a serious responsibility, and we want you to know how we're handling it.

The entity  responsible for the processing of your personal information in connection with the services is Max-Planck-Gesellschaft zur Förderung der Wissenschaften e.V. (MPG); Hofgartenstrasse 8, 80539 Munich; Telephone: +49 (89) 2108-0.

The Data Protection Officer at the entity responsible is Heidi Schuster, Hofgartenstrasse 8, 80539 Munich, Telephone: +49 (89) 2108-1554, E-mail: datenschutz@mpg.de

**What personal data Flaski collects**

Flaski collects your first name, last name, organization name, and email address. Additionally, Flaski collects email and time stamps on performed actions like figure download or login to an app.

**What personal data Flaski does not collect**

Flaski does not collect your input data. You can store your data in our servers but we generally will not look into it other than stated below.

**How Flaski collets information**

Every time you visit an App (or eg. download a figure or an error occurs) a timestamp, App, and user email contact is recorded in a MySQL/MariaDB which is accessible to Flaski’s administrators only. 

**Why Flaski collects your information**

Flaski is an open source project supported by the private and work time of it’s developers. In order to continuously keep on improving Flaski we might need to apply for funding. It is therefore important that we are able to demonstrate a concrete usage of Flaski and from which institutions our usage originates so that we can choose the appropriate funding organizations.

**How Flaski uses your information**

We collect usage statistics to better understand our Apps and develop them further for you.

**How we share the information we collect**

When reporting usage statistics we deplete user's first name, last name, and email from that report. We might include organizations names in such reports. We do not share any users account with any other public or private organization. 

**How you can access the information we collect**

If you want to permanently remove all traces of your account from our data bank please mail us from your user's email address to flaski@age.mpg.de.

**Our use of cookies and tracking**

Flaski only uses minimal functionality cookies so that your input data does not vanish every time you press “Submit” or refresh the page. Flaski's minimal functionality cookies only collect the values that you input into an App (eg. range of x-axis) so that the instructions you give to Flaski can be executed. Session cookies are permanently cleared every time you logout. Flaski does not perform tracking. Cookies are text files stored in the Internet browser or by the Internet browser on the user's computer system.

**How Flaski secures your information**

We take all measures reasonably necessary to protect the confidentiality, integrity, and availability of your personal information on Flaski and to protect the resilience of our servers.

Flaski takes all measures reasonably necessary to protect User Personal Information from unauthorized access, alteration, or destruction; maintain data accuracy; and help ensure the appropriate use of User Personal Information.

Flaski enforces a written security information program. Our program:

- aligns with industry recognized frameworks;
- includes security safeguards reasonably designed to protect the confidentiality, integrity, availability, and resilience of our Users' data;
- is appropriate to the nature, size, and complexity of Flaski's business operations;
- includes incident response and data breach notification processes.

In the event of a data breach that affects your User Personal Information, we will act promptly to mitigate the impact of a breach and notify any affected Users without undue delay.

Transmission of data on Flaski is encrypted using SSH, HTTPS (TLS). We manage our own cages and racks at our own data centers with high level of physical and network security.

No method of transmission, or method of electronic storage, is 100% secure. Therefore, we cannot guarantee its absolute security.

Flaski, the Max Planck Institute for Biology of Ageing, and it's personnel can not be hold be responsible for the misusage for Flaski servers by a third-party as it would be the case of for example an hacking event.

**Other important information**

*Data storage*

Flaski personnel do not access private repositories unless required to for security purposes, to assist the repository owner with a support matter, to maintain the integrity of the service, or to comply with our legal obligations. However, while we do not generally search for content in your repositories, we may scan our servers and content to detect certain tokens or security signatures, known active malware, or other content such as violent extremist or terrorist content or child exploitation imagery, based on algorithmic fingerprinting techniques.

Flaski regularly scans it's servers for old, untouched data and marks it for deletion. Users are informed of this mark and are given time to properly backup their data.

Personal data will be deleted too if you ask us to delete it or either above purposes are achieved. Data will be delete once it reaches an age of 10 years.

*Data analysis*

Flaski purpose is to support researchers on the analysis of their data. For this we constantly enhance the number and quality of our app promptly responding to user's requests. Flaski, the Max Planck Institute for Biology of Ageing, and it's personnel can not be hold responsible for any data analysis performed with Flaski nor for any misinterpretation that might come from an undesirable or misunderstood function. Flaski's code is public and open source and we encourage all users to follow it's code as a trace to their analysis.   

*What are my rights as a data subject?*

As an individual whose personal data is gathered as part of the aforementioned services, you have, in principle, the following rights, to the extent that no legal exceptions are applicable in individual cases:

- Information (Article 15 GDPR)
- Correction (Article 16 GDPR)
- Deletion (Article 17 (1) GDPR)
- Restriction of processing (Article 18 GDPR)
- Data transmission (Article 20 GDPR)
- Revocation of processing (Article 21 GDPR)
- Revocation of consent (Article 7 (3) GDPR)
- Right to complain to the regulator (Article 77 GDPR). For the MPG, this is the Bavarian Data Protection Authority (BayLDA), Postbox 606, 91511 Ansbach

**Contacting Flaski**

Please feel free to contact us if you have questions about our Privacy and Data Statement. Contact details:

Max Planck Institute for Biology of Ageing 

Joseph-Stelzmann-Str. 9b

50931 Köln

Phone: +49 221 37970-0

Email: bioinformatics@age.mpg.de

''')

dashapp.layout=dbc.Row(
                    [ dbc.Col( 
                        [ html.H1("DATA AND PRIVACY", style={"textAlign":"center", "margin-bottom":"30px"}), gdpr_text ],  # 
                        align="top", 
                        style={"textAlign":"justify",'margin-left':"15px", 'margin-right':"15px","margin-top":"100px"},
                        md=8, lg=6, xl=4), 
                    navbar_A ] ,
                    justify="center")